package bot

import (
	"testing"

	"github.com/drewlanenga/govector"
	"github.com/stretchr/testify/assert"
)

func TestEmbedding(t *testing.T) {
	a, _ := govector.AsVector([]float32{-0.2046233, -0.022026513, 0.028468976, 0.08251369, -0.0030027372, -0.010956718, 0.029126875, 0.017272558, 0.09096369, -0.06281162, 0.018910099, -0.06514305, 0.023815988, 0.029983077, -0.018193243, 0.08157901, -0.009915341, 0.05894802, 0.01688916, 0.022567943, 0.057015553, 0.055191334, -0.026291259, 0.014047005, 0.015627915, -0.041678946, 0.029572228, 0.0013239048, -0.031787626, 0.03906615, -0.011742045, -0.06803624, -0.0184642, 0.013523407, 0.016949676, 0.09206735, -0.0386174, -0.060431927, 0.00032359688, -0.06955107, 0.03244299, -0.012636437, -0.010266571, 0.002044244, -0.0020794848, 0.014823751, 0.03632791, -0.010177766, -0.0060611404, 0.014892983, 0.0356921, -0.018777959, -0.008243835, -0.029208837, 0.020499185, -0.012487608, 0.007913532, 0.035535287, 0.0044114087, 0.023208875, 0.002873525, 0.017701915, 0.034165185, -0.026876256, 0.0045758975, 0.018334081, 0.0040373253, 0.04804683, -0.020456135, 0.012157936, -0.042411156, -0.020744072, -0.0066396, 0.016999234, -0.026866551, 0.015958248, -0.011122951, 0.0030599418, 0.009062596, 0.025143247, 0.012055891, -0.015234031, 0.019571042, 0.012751064, 0.019988602, 0.02622599, 0.016330188, 0.009935554, -0.000101090714, -0.043195732, -0.024492553, 0.03275531, 0.0010033118, 0.00034252089, -0.0011712242, -0.004593248, 0.021651031, 0.021666758, -0.017922197, -0.0007021075})
	b, _ := govector.AsVector([]float32{-0.21385951, -0.020870402, 0.053375296, 0.09230549, 0.0062988596, -0.011883218, 0.017824506, 0.062477097, 0.053160008, -0.054524288, 0.012885212, -0.056548327, 0.029230237, -0.005145558, -0.01425094, 0.0654019, 0.0006420099, 0.05903293, 0.006494866, 0.012895132, 0.04294406, 0.053717993, -0.041144352, 0.009911478, 0.03299959, -0.040267088, 0.03122021, -0.0078089326, -0.028805027, 0.02506149, -0.011974913, -0.05789814, -0.02042555, 0.019506209, 0.007936628, 0.110947944, -0.023690417, -0.07119492, 0.0058847107, -0.062044285, 0.019535935, -0.005885733, -0.017841052, -0.005167019, 0.0059522414, 0.012231415, 0.03151156, -0.018827565, -0.022419352, 0.023690322, 0.030699886, -0.011314588, -0.003176537, -0.023127161, 0.020406388, -0.0015781109, 0.0049422025, 0.027282275, 0.0013280667, 0.035343155, 0.014749111, 0.0042124903, 0.027489642, -0.021498341, 0.0014124477, 0.0136264665, -0.008606255, 0.04252986, -0.0061811386, 0.014591267, -0.041568667, -0.025240771, -0.002085906, 0.012288577, -0.041729372, 0.0069256052, -0.007705723, 0.007149281, -0.005028577, 0.016214475, 0.009357461, -0.011778682, 0.016736422, 0.0143109625, 0.019054774, 0.0197832, 0.010398859, 0.0016498897, -0.003941197, -0.030713508, -0.02982454, 0.039167713, -0.006404586, 0.00023291662, -0.009192385, 0.00040785133, 0.027513323, 0.021163044, -0.017019186, 0.0022130648})
	c, _ := govector.AsVector([]float32{-0.13181256, -0.025984073, -0.0387224, 0.07539925, 0.021906337, 0.02842857, 0.10303362, 0.04944355, 0.1186494, -0.044040807, -0.05286765, -0.043910243, 0.025708126, 0.077909425, 0.14734107, 0.023005074, -0.0068723294, -0.06305223, 0.062979326, 0.03228115, 0.020463038, 0.023685647, -0.04228997, -0.0039048288, -0.027774116, 0.018639207, 0.02942788, 0.026424205, -0.025951622, 0.047337882, 0.053085033, -0.050609723, 0.05507492, 0.024980998, 0.01316865, 0.06268959, -0.073338985, -0.053837612, 0.012502336, 0.017587973, 0.011913559, -0.0058858357, 0.044347372, -0.023587305, -0.051690545, 0.022375505, 0.06599468, -0.013084388, -0.022710584, 0.029999606, 0.07824127, -0.04265772, -0.026167495, -0.048594512, -0.015772615, -0.022792587, 0.009244227, 0.038373582, 0.017664868, 0.036033224, 0.031137334, 0.018799385, -0.0014714085, 0.012137284, -0.030880582, 0.027687283, -0.006195717, 0.052108563, -0.005355862, 0.0006957038, 0.013224415, -0.0075278278, 0.053485397, 0.009762361, -0.014432774, -0.023535881, 0.0013365285, 0.02579727, 0.0021221875, 0.049864862, 0.035545297, -0.0025165158, -0.0173499, -0.025097298, 0.017062351, 0.021462876, 0.0048677567, 0.018771414, 0.004548944, -0.0011087176, -0.013375576, -0.0054289307, -0.019418985, 0.002021407, -0.03619359, -0.0178676, 0.01386673, -0.007830782, 0.0056980667, 0.02586669})
	assert.True(t, isEmbeddingSimilar(a, b))
	assert.False(t, isEmbeddingSimilar(a, c))

	d, _ := govector.AsVector([]float32{-0.20615073, -0.034001198, 0.04212214, -0.022583846, 0.009895038, 0.046078566, 0.11815988, -0.027467698, 0.0014224246, -0.0505274, -0.028214915, 0.026824117, -0.039702, 0.024650844, 0.0022326163, 0.009898506, -0.024695545, -0.12469664, -0.049801968, 0.045449194, 0.009854571, 0.035239335, 0.011391759, 0.0503498, -0.0012824478, 0.025922528, -0.0462397, -0.023673387, -0.042986643, -0.080193855, -0.061476056, 0.041439038, 0.033551633, -0.07049968, 0.04927885, -0.04137114, -0.008593997, -0.029038753, -0.011038134, -0.024717527, 0.008704099, 0.044965655, 0.04664163, -0.039448824, -0.069434084, -0.030274231, 0.0391587, 0.005624033, -0.01584862, 0.0464099, -0.036374625, 0.010678023, -0.014994486, -0.009061843, 0.07721913, 0.008881568, 0.044795398, 1.6084314e-05, 0.028426934, 0.00069120876, -0.030362278, -0.009980647, -0.013254943, 0.00010479035, -0.02643467, -0.007007341, 0.024021395, 0.04183747, -0.035626378, -0.0012870315, 0.001049517, -0.030435672, -0.021502584, -0.0020074616, -0.011812982, -0.038482934, -0.08229694, -0.014510535, 0.018400602, 0.007836624, 0.014276405, 0.009334085, 0.028197488, -0.031065905, -0.029032858, -0.026079088, 0.025374692, 0.004821221, -0.015774544, -0.010648935, 0.00952701, -0.03144269, 0.017505685, -0.0057717813, 0.030018842, -0.02667885, 0.002247596, 0.054526344, 0.011232299, -0.023554584})
	e, _ := govector.AsVector([]float32{-0.21152647, -0.04350572, 0.014537938, -0.028530989, 0.014847185, 0.049058154, 0.10886059, -0.043822736, -0.0004994626, -0.049406625, -0.05237334, 0.00749544, -0.050021302, 0.016192745, 0.02338148, -0.006379436, -0.019433638, -0.14098862, -0.06097983, 0.069531456, -0.00021571672, 0.041993175, 0.008398193, 0.062159725, -0.012409977, 0.05401693, -0.016765205, -0.038940158, -0.03695155, -0.07456726, -0.06666606, 0.030160017, 0.041943066, -0.046528596, 0.046458814, -0.019832656, -0.020422975, -0.01103329, 0.005416384, -0.021934735, 0.02326615, 0.043305226, 0.029564004, -0.03316127, -0.08447395, -0.03545406, 0.0033217627, -0.0024445807, -0.0275069, 0.04438814, -0.03719352, 0.014796842, -0.010516096, -0.014162457, 0.07050615, 0.0018936204, 0.04396025, -0.009047236, 0.030606633, 0.015170192, -0.020576758, -0.019855581, -0.009037748, -6.485769e-05, -0.02907896, -0.004029315, 0.020070251, 0.03575351, -0.034225326, -0.0007307357, 0.021679904, -0.033404868, -0.039142326, -0.01176327, -0.023639424, -0.048902683, -0.059537906, -0.011279284, 0.0059033744, -0.0063205105, 0.020643013, 0.023140822, 0.047814053, -0.03926181, -0.03448576, -0.02899372, 0.01967923, 0.009814511, -0.012512027, -0.0077036377, 0.02775477, -0.03571408, 0.024577243, -0.008372018, 0.02645046, -0.021989828, 0.002363062, 0.04884729, 0.015873797, -0.0067271604})
	assert.True(t, isEmbeddingSimilar(e, d))
}
